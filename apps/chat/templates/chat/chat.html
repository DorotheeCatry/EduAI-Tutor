{% extends 'core/base.html' %}

{% block title %}Recherche Intelligente - EduAI Tutor{% endblock %}

{% block content %}
<div class="flex flex-col h-full">
    <div class="p-4 border-b border-gray-700">
        <div class="flex items-center space-x-3">
            <i data-lucide="search" class="w-6 h-6 text-primary-blue"></i>
            <h1 class="text-xl font-bold text-white">Recherche Intelligente</h1>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chat-messages">
        <div class="flex items-start space-x-3">
            <div class="w-8 h-8 rounded-full bg-primary-blue flex items-center justify-center">
                <i data-lucide="bot" class="w-5 h-5 text-white"></i>
            </div>
            
            <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-lg bg-gray-800 text-gray-100 border border-gray-700">
                <p class="text-sm">Bonjour ! Je suis votre assistant IA. Posez-moi vos questions sur la programmation, les concepts techniques, ou tout autre sujet d'apprentissage.</p>
                <p class="text-xs opacity-70 mt-1" id="initial-time"></p>
            </div>
        </div>
    </div>

    <div class="p-4 border-t border-gray-700">
        <form id="chat-form" class="flex space-x-2">
            {% csrf_token %}
            <input
                type="text"
                id="message-input"
                name="message"
                placeholder="Posez votre question..."
                class="flex-1 px-4 py-3 bg-gray-900 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary-blue focus:ring-1 focus:ring-primary-blue transition-colors"
                required
            />
            <button
                type="submit"
                id="send-button"
                class="p-3 rounded-lg transition-all duration-200 bg-primary-blue text-white hover:bg-blue-600 hover:scale-105 active:scale-95"
            >
                <i data-lucide="send" class="w-5 h-5"></i>
            </button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
        
        // Set initial time
        document.getElementById('initial-time').textContent = new Date().toLocaleTimeString();

        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');

        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            messageInput.value = '';
            
            // Show loading
            showLoading();
            
            // Simulate AI response (replace with actual API call)
            setTimeout(() => {
                hideLoading();
                addMessage('Je comprends votre question. Voici une explication détaillée avec des exemples pratiques...', false);
            }, 1500);
        });

        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex items-start space-x-3 ${isUser ? 'justify-end' : 'justify-start'}`;
            
            const time = new Date().toLocaleTimeString();
            
            messageDiv.innerHTML = `
                ${!isUser ? `
                    <div class="w-8 h-8 rounded-full bg-primary-blue flex items-center justify-center">
                        <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                    </div>
                ` : ''}
                
                <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-lg ${
                    isUser ? 'bg-primary-green text-white' : 'bg-gray-800 text-gray-100 border border-gray-700'
                }">
                    <p class="text-sm">${text}</p>
                    <p class="text-xs opacity-70 mt-1">${time}</p>
                </div>

                ${isUser ? `
                    <div class="w-8 h-8 rounded-full bg-primary-rose flex items-center justify-center">
                        <i data-lucide="user" class="w-5 h-5 text-white"></i>
                    </div>
                ` : ''}
            `;
            
            chatMessages.appendChild(messageDiv);
            lucide.createIcons();
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-message';
            loadingDiv.className = 'flex items-start space-x-3';
            loadingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-primary-blue flex items-center justify-center">
                    <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                </div>
                <div class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-3">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce animate-bounce-delay-1"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce animate-bounce-delay-2"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            lucide.createIcons();
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideLoading() {
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }
    });
</script>
{% endblock %}