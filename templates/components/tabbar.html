<!-- Tab Bar Component - Exact KodaTheme Design with Dynamic Behavior -->
<div class="h-10 bg-gray-800/80 backdrop-blur-md border-b border-gray-700/50 flex items-center shadow-sm flex-shrink-0">
    <div class="flex" id="tabs-container">
        <!-- Tabs will be added dynamically here -->
    </div>
</div>

<script>
// Dynamic tab management with chronological order
let openTabsOrder = []; // Array to maintain opening order

// Available tabs configuration
const availableTabs = {
    'profile': {
        title: 'Profile',
        url: "/auth/profile/"
    },
    'courses': {
        title: 'Course Generator',
        url: "/courses/generator/"
    },
    'my-courses': {
        title: 'My Courses',
        url: "/courses/my-courses/"
    },
    'chat': {
        title: 'AI Search',
        url: "/chat/search/"
    },
    'quiz': {
        title: 'Quiz & MCQ',
        url: "/quiz/lobby/"
    },
    'exercises': {
        title: 'Python Exercises',
        url: "/exercises/"
    },
    'tracker': {
        title: 'Performance',
        url: "/tracker/dashboard/"
    },
    'revision': {
        title: 'Revision',
        url: "/revision/flashcards/"
    }
};

// Detect current tab based on URL
function getCurrentTab() {
    const path = window.location.pathname;
    if (path.includes('profile')) return 'profile';
    if (path.includes('generator')) return 'courses';
    if (path.includes('my-courses')) return 'my-courses';
    if (path.includes('chat')) return 'chat';
    if (path.includes('quiz')) return 'quiz';
    if (path.includes('exercises')) return 'exercises';
    if (path.includes('tracker')) return 'tracker';
    if (path.includes('revision')) return 'revision';
    return null;
}

// Add tab in chronological order
function addTab(tabId) {
    if (!availableTabs[tabId]) return;
    
    // If tab is not already open, add it at the end
    if (!openTabsOrder.includes(tabId)) {
        openTabsOrder.push(tabId);
        renderTabs();
        saveTabsToStorage();
    }
}

// Close a tab
function closeTab(event, tabId) {
    event.stopPropagation();
    
    // Remove tab from ordered list
    const index = openTabsOrder.indexOf(tabId);
    if (index > -1) {
        openTabsOrder.splice(index, 1);
    }
    
    // If closing current tab and there are others, go to first
    const currentTab = getCurrentTab();
    if (tabId === currentTab && openTabsOrder.length > 0) {
        const firstTab = openTabsOrder[0];
        window.location.href = availableTabs[firstTab].url;
    } else if (openTabsOrder.length === 0) {
        // If no more tabs, go to home
        window.location.href = "/courses/generator/";
    } else {
        renderTabs();
        saveTabsToStorage();
    }
}

// Navigate to a tab
function navigateToTab(tabId) {
    window.location.href = availableTabs[tabId].url;
}

// Render tabs in chronological order
function renderTabs() {
    const container = document.getElementById('tabs-container');
    const currentTab = getCurrentTab();
    
    if (!container) return;
    
    container.innerHTML = '';
    
    // Display tabs in chronological opening order
    openTabsOrder.forEach(tabId => {
        const tab = availableTabs[tabId];
        if (!tab) return;
        
        const isActive = tabId === currentTab;
        
        const tabElement = document.createElement('div');
        tabElement.className = `h-10 px-4 flex items-center text-sm border-r border-gray-700 cursor-pointer transition-colors duration-150 group relative ${
            isActive ? 'bg-gray-900/90 text-white backdrop-blur-sm' : 'bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 backdrop-blur-sm'
        } z-10`;
        
        tabElement.innerHTML = `
            <span class="mr-2 truncate max-w-32">${tab.title}</span>
            <button class="opacity-0 group-hover:opacity-100 transition-opacity duration-150 p-1 hover:bg-gray-600 rounded" onclick="closeTab(event, '${tabId}')">
                <i data-lucide="x" class="w-3 h-3"></i>
            </button>
        `;
        
        tabElement.addEventListener('click', () => navigateToTab(tabId));
        container.appendChild(tabElement);
    });
    
    // Reinitialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
}

// Save tab order
function saveTabsToStorage() {
    localStorage.setItem('openTabsOrder', JSON.stringify(openTabsOrder));
}

// Load tab order
function loadTabsFromStorage() {
    const savedTabs = localStorage.getItem('openTabsOrder');
    if (savedTabs) {
        try {
            const tabsArray = JSON.parse(savedTabs);
            openTabsOrder = tabsArray.filter(tabId => availableTabs[tabId]);
        } catch (e) {
            console.log('Error loading saved tabs');
            openTabsOrder = [];
        }
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load saved tabs
    loadTabsFromStorage();
    
    // Add current tab if not already in list
    const currentTab = getCurrentTab();
    if (currentTab && !openTabsOrder.includes(currentTab)) {
        openTabsOrder.push(currentTab);
    }
    
    renderTabs();
});

// Save open tabs before leaving
window.addEventListener('beforeunload', function() {
    saveTabsToStorage();
});

// Global function to open tab from sidebar
window.openTab = function(tabId) {
    addTab(tabId);
    navigateToTab(tabId);
};
</script>